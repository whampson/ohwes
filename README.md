# NbOS - Niobium Operating System
A toy operating system that'll probably never get finished.

## Building
**TODO: installing msys2 (Windows) and acquiring the i686-elf-tools**

**NbOS** uses GNU Make for building all source and external tools.

To set up the build environment and build **NbOS**, run the following from the
repository root:
```
$ source src/scripts/env.sh
$ make
```

To delete binaries and object files generated by the current build:
```
$ make clean
```

To delete all binaries and object files:
```
$ make nuke
```

To output useful variables for debugging your Makefile:
```
$ make debug-make
```

### Build System
The most basic Makefile looks like this:
```make
include $(_MAKEGOD)
```
When invoked via `make`, this will compile all the source in the current
directory. `$(_MAKEGOD)` refers to the master Makefile located at the repository
root, outside of the src/ directory, which contains all the build infrastructure
and must be included in every Makefile.

The above Makefile only compiles source; it does invoke the linker or output
binaries. To build a binary, add a `TARGET` definition before summoning the
make god:
```make
TARGET = my_exe

include $(_MAKEGOD)
```
This will output an executable file named 'my_exe' in the current directory,
built from the source in that directory. To move the file to a common location,
you may use the `$(BIN_DIR)` variable as a path prefix:
```make
TARGET = $(BIN_DIR)/my_exe

include $(_MAKEGOD)
```

Note that the `TARGET` definition appears before the `include` directive. This
is **required** as the `TARGET` variable is a *prerequisite variable* that
affects Makefile behavior. Prerequisite variables affect the control flow of the
master Makefile and thus their existence or absence affects the operations
performed by the Makefile. A complete list of prerequisite variables can be
found below.

In addition to prerequisite variables are *dependent variables*. Dependent
variables are defined by the master Makefile and can be appended or overridden
in child Makefiles, and thus are defined after the `include` directive:
```make
TARGET = $(BIN_DIR)/my_exe

include $(_MAKEGOD)

C_DEFINES += MY_EXE PREFIX=foo
```
This will append the existing `C_DEFINES` with `MY_EXE` and `PREFIX=foo`.
When compiling .c files, `C_DEFINES` is expanded into something resembling
`-DMY_EXE -DPREFIX=foo` and combined with the other C compiler flags. As such,
C defines that specify a value must not include spaces surrounding the '=' sign.

Subdirectories can be compiled by adding a `DIRS` definition, so long as each
subdirectory contains a Makefile:
```make
DIRS = my_feature1 my_feature2
TARGET = $(BIN_DIR)/my_exe

include $(_MAKEGOD)

C_DEFINES += MY_EXE PREFIX=foo
```
This will build the source found in subdirectories named `my_feature1` and
`my_feature2` before building the source in the current directory. Note that
this does not declare the subdirectories as dependencies on the source in
the current directory! **(Feature support for dependencies is coming soon!!)**

#### Prerequisite Variables
* `CODE_BASE`
* `DIRS`
* `ENTRY_POINT`
* `TARGET`

#### Dependent Variables
* `ARCH`
* `AS`
* `AS_FLAGS`
* `AS_DEFINES`
* `AS_WARNINGS`
* `BIN_PATH`
* `CC`
* `C_FLAGS`
* `C_DEFINES`
* `C_WARNINGS`
* `DEBUG`
* `INC`
* `LD`
* `LD_FLAGS`
* `LD_WARNINGS`
* `MKDIR`
* `OBJCOPY`
* `OBJCOPY_FLAGS`
* `OBJ_PATH`
* `RM`
